---
title: Vim 使用技巧
date: 2020-09-01
tags: [Vim, 编辑器, 技巧, 使用]
categories: [Vim, 日常应用, 编辑工具]
---

- [编辑技巧](#编辑技巧)
  - [如何改变大小写？](#如何改变大小写)
  - [如何将内容复制到系统剪切板？](#如何将内容复制到系统剪切板)
- [替换技巧](#替换技巧)
  - [如何实现零宽断言？](#如何实现零宽断言)
  - [如何改变正则的 magic 模式？](#如何改变正则的-magic-模式)
  - [如何设定贪婪或非贪婪匹配？](#如何设定贪婪或非贪婪匹配)
- [重复操作](#重复操作)
  - [如何录制宏（Macro）？](#如何录制宏macro)

# 编辑技巧
## 如何改变大小写？
1. 可视化模式选中目标。
2. `gu`：将目标变为小写；`gU`：将目标变为大写。

## 如何将内容复制到系统剪切板？
1. 在常规模式或可视化模式下选中要复制的内容。
2. 输入命令 `"*y`，内容会直接复制到系统剪切板，同 `Ctrl+C` 复制操作效果相同，同样可以使用 `Ctrl+V` 粘贴。
   1. 命令中的引号（"）用来选择寄存器。
   2. 命令中的星号（*）表示系统寄存器。
   3. 命令中的字符（y）即复制操作 `yank`。
3. 寄存器更多香瓜内容记录在：{% post_link 'Vim 寄存器' %}。

# 替换技巧
## 如何实现零宽断言？
Vim 的零宽断言规范与常用正则规范不同，具体如下：

| |前向|后向|
|:-:|:-:|:-:|
|**肯定**| `(atom)\@<=` | `(atom)\@=` |
|**否定**| `(atom)\@<!` | `(atom)\@!` |

* 注意
  * 在实际应用中，`(atom)` 左右的括号需要加反斜杠转义，即最终形式 `\(atom\)`，原因是 Vim 默认将括号等计为常规字符，转义后才具有功能特性。

* 参考
  * [Regex lookahead and lookbehind](https://vim.fandom.com/wiki/Regex_lookahead_and_lookbehind)

## 如何改变正则的 magic 模式？
magic 模式决定 Vim 对字符的翻译方式，是直译或是转义，有四种选项：
* magic：默认模式，也可在表达式中使用 `\m` 主动触发，表示其后的内容中，规定的字符默认会具备转义含义，不再被当做文本字符直译。
* nomagic：表达式中使用 `\M` 触发，表示其后的内容中，除 ^、$ 两个标记行首尾的转义字符外，其他字符都按字面义直译。
* very-magic：表达式中使用 `\v` 触发，表示其后的内容中，只有 0-9a-zA-z 和 _ 字符为直译字符，其他字符都默认具备转义含义。
* very-nomagic：表达式中使用 `\V` 触发，表示其后的内容中，所有字符都为直译字符。

magic 模式下默认转义的字符集合：

|字符|含义|
|:-:|:-:|
|^|行首|
|$|行尾|
|.|任意字符|
|*|任意次数|
|~|上次执行的替换表达式中的替换字符串|
|[]|列表范围|

* 注意
  * 在上述所有模式中，转义字符 \ 都是表达转义含义的功能性字符。

* 参考
  * [VimDoc#pattern#magic](http://vimdoc.sourceforge.net/htmldoc/pattern.html#/magic)
  * [VIM学习笔记 4 种 Magic 模式](http://yyq123.github.io/learn-vim/learn-vim-Regex-4MagicModes.html)

## 如何设定贪婪或非贪婪匹配？
标准正则中，当问号（?）跟在其他限制符（*、+ 等）之后时，解析器会认定该匹配模式是非贪婪匹配。Vim 中没有类似问号（?）的标记符，它只是给特定的限制符赋予了贪婪或非贪婪匹配的语义。

|贪婪限制符|含义|
|:-:|:-:|
|*|0 到多次|
|\{}|0 到多次|
|\\+|1 到多次|
|\\=|0 或 1 次|
|\\?|0 或 1 次|
|\\{m, n}|m 到 n 次|
|\\{m, }|m 到多次|
|\\{, n}|0 到 n 次|
|\\{m}|m 次|

|非贪婪限制符|含义|
|:-:|:-:|
|\\{-}|0 到多次|
|\\{-m, n}|m 到 n 次|
|\\{-m, }|m 到多次|
|\\{-, n}|0 到 n 次|

需要注意“0 到多次”在不同匹配模式下的解释方法，看下面的例子：
```shell
# 源字符串
STARTaaaabbbbccccEND

# 匹配公式：A
:'<,'>s/a*/-/g

# 结果：B
# -S-T-A-R-T-b-b-b-b-c-c-c-c-E-N-D

# 匹配公式：B
:'<,'>s/a\{-}/-/g

# 结果：B
# -S-T-A-R-T-a-a-a-a-b-b-b-b-c-c-c-c-E-N-D
```
1. 在贪婪模式下：如果有匹配项则尽量匹配最大内容；如果没有匹配项则尝试将首个未匹配位（可以是空位）替换为目标字符。
2. 在非贪模式下：不论是否有匹配，都尝试将首个未匹配位（可以是空位）替换为目标字符。
  
* 参考：
  * [Vim Greedy and NonGreedy](http://vimregex.com/#Non-Greedy)


# 重复操作
## 如何录制宏（Macro）？
流程示例：
  ```
  qa    // 开始录制，其中 a 代表寄存器序号，可选值 [a-zA-Z0-9]
  ...   // 录制中：一系列实际操作
  q     // 结束录制
  @a    // 运行一次 a 寄存器内宏操作
  @@    // 重复运行上次宏操作
  ```

* 参考
  * [Vim 重复操作的宏录制](https://www.cnblogs.com/ini_always/archive/2011/09/21/2184446.html)
  * [Vim Macros Tutorial](https://vim.fandom.com/wiki/Macros)
  * [Vim Help: complex-repeat](https://vimhelp.org/repeat.txt.html#complex-repeat)